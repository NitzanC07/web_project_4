!function(){"use strict";class e{constructor(e,t){this._settings=e,this._formElement=document.querySelector(`${t}`)}_showErrorMessage(e,t){const{inputErrorClass:s,errorClass:r}=this._settings;this._errorElement=this._formElement.querySelector(`.${e.id}-error`),this._errorElement.textContent=t,this._errorElement.classList.add(s),e.classList.add(r)}_hideErrorMessage(e){const{inputErrorClass:t,errorClass:s}=this._settings;this._errorElement=this._formElement.querySelector(`.${e.id}-error`),this._errorElement.textContent="",this._errorElement.classList.remove(t),e.classList.remove(s)}_checkInputValidity(e){if(e.validity.valid)this._hideErrorMessage(e);else{const t=e.validationMessage;this._showErrorMessage(e,t)}}_inputsList(){const{inputSelector:e}=this._settings;return Array.from(this._formElement.querySelectorAll(e))}_selectButton(){const{submitButtonSelector:e}=this._settings;return this._formElement.querySelector(e)}_toggleButtonState(){const{inactiveButtonClass:e}=this._settings,t=this._selectButton();this._inputsList().some((e=>!e.validity.valid))?(t.classList.add(e),t.setAttribute("disabled",!0)):(t.classList.remove(e),t.removeAttribute("disabled"))}_setEventListeners(){this._inputsList().forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{})),this._setEventListeners()}resetValidation(){const{inactiveButtonClass:e}=this._settings,t=this._selectButton();t.classList.add(e),t.setAttribute("disabled","true"),this._inputsList().forEach((e=>{this._hideErrorMessage(e)}))}}var t=class{constructor({items:e,renderer:t},s){this._items=e,this._renderer=t,this._container=document.querySelector(s)}renderer(){this._items.forEach((e=>{const t=this._renderer(e);this.addItem(t)}))}addItem(e){this._container.prepend(e)}};const s=document.querySelector("#card-template").content,r=".cards__container",n={inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_disable",inputErrorClass:"popup__input_type_error",errorClass:"popup__input_error-visible"},i=document.querySelector(".profile__name"),o=document.querySelector(".profile__description"),a=document.querySelector(".popup__input_content_name"),d=document.querySelector(".popup__input_content_description"),l=document.querySelector(".popup__image"),c=document.querySelector(".popup__image-description");var _=class{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this),this._handleClosePopupwWithOverlay=this._handleClosePopupwWithOverlay.bind(this)}_handleEscClose(e){"Escape"===e.key&&this.close()}_handleClosePopupwWithOverlay(e){e.target.classList.contains("popup_open")&&this.close()}setEventListeners(){this._popup.querySelector(".popup__close-button").addEventListener("click",(()=>{this.close()}))}open(){this._popup.classList.add("popup_open"),document.addEventListener("keydown",this._handleEscClose),document.addEventListener("mousedown",this._handleClosePopupwWithOverlay)}close(){this._popup.classList.remove("popup_open"),document.removeEventListener("keydown",this._handleEscClose),document.removeEventListener("mousedown",this._handleClosePopupwWithOverlay)}},h=class extends _{constructor(e,t){super(e),this._submitHandler=t,this._form=this._popup.querySelector(".popup__form")}getInputsValues(){const e=Array.from(this._form.querySelectorAll(".popup__input")),t={};return e.forEach((e=>{t[e.name]=e.value})),t}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._submitHandler()}))}close(){super.close(),this._form.reset()}};const u=(e,t)=>fetch(e,t).then((e=>e.ok?e.json():Promise.reject(e.statusText))).catch((e=>console.log(e))),p=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}getInitialCards(){return u(`${this._baseUrl}/cards`,{headers:this._headers,method:"GET"})}getUserInfo(){return u(`${this._baseUrl}/users/me`,{headers:this._headers})}createCard(e){return u(`${this._baseUrl}/cards`,{headers:this._headers,method:"POST",body:JSON.stringify(e)})}deleteCard(e){return u(`${this._baseUrl}/cards/${e}`,{headers:this._headers,method:"DELETE"})}likeCard(e){return console.log("cardId",e),u(`${this._baseUrl}/cards/likes/${e}`,{headers:this._headers,method:"PUT"})}dislikeCard(e){return u(`${this._baseUrl}/cards/likes/${e}`,{headers:this._headers,method:"DELETE"})}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"38a23878-64ce-4abb-ae0d-d30d11cc9a38","Content-Type":"application/json"}});let m;const E=new class extends _{open(e){super.open(),l.src=e.link,l.alt=e.name,c.textContent=e.name}}(".popup_type_image");E.setEventListeners();const v=new e(n,".popup__form_profile"),b=new e(n,".popup__form_add-card");v.enableValidation(),b.enableValidation(),p.getInitialCards().then((e=>{new t({items:e,renderer:y},r).renderer()})),p.getUserInfo().then((e=>{L.setUserInfo({name:e.name,about:e.about}),m=e._id}));const C=new class extends _{setAction(e){this._submitHandler=e}setEventListeners(){this._popup.addEventListener("submit",(e=>{e.preventDefault(),this._submitHandler(),this.close()}))}}(".popup_type_delete-card");C.setEventListeners();const y=e=>{const t=new class{constructor({data:e,handleCardClick:t,handleDeleteCard:s,handleLikeIcon:r},n,i){this._template=n,this._name=e.name,this._link=e.link,this._ownerId=e.owner._id,this._handleCardClick=t,this._handleLikeIcon=r,this._handleDeleteCard=s,this._userId=i,this._likes=e.likes,this._cardId=e._id}_setEventListeners(){const e=this._card.querySelector(".cards__like-button");e.addEventListener("click",(()=>this._handleLikeIcon(this._cardId,this._userId,this._likes,e))),this._card.querySelector(".cards__delete-button").addEventListener("click",(()=>this._handleDeleteCard(this._userId))),this._ownerId!==this._userId&&(this._card.querySelector(".cards__delete-button").style.display="none");const t={name:this._name,link:this._link};this._card.querySelector(".cards__image").addEventListener("click",(()=>{this._handleCardClick(t)}))}removeCard(){this._card.remove(),this._card=null}createCard(){const e=this._template.querySelector(".cards__card").cloneNode(!0),t=e.querySelector(".cards__image");return t.setAttribute("src",this._link),t.setAttribute("alt",this._name),e.querySelector(".cards__header").textContent=this._name,this._card=e,this._card.querySelector(".cards__likes-counter").textContent=this._likes.length,this._setEventListeners(),this._card}}({data:e,handleCardClick:()=>{E.open(e)},handleLikeIcon:(e,t,s,r)=>{s.find((e=>e._id===t))?(console.log("DISLIKE"),console.log(r),r.classList.remove("cards__like-button_active"),p.dislikeCard(e).then((e=>{console.log("Removed like from card: ",e)}))):(console.log("LIKE"),console.log(r),r.classList.add("cards__like-button_active"),p.likeCard(e).then((e=>{console.log("Added like to card: ",e)})))},handleDeleteCard:()=>{C.open(),C.setEventListeners(),C.setAction((()=>{p.deleteCard(e._id).then((e=>{console.log("card is deleted",e),t.removeCard()}))}))}},s,m);return t.createCard()},L=new class{constructor(e,t){this._name=e,this._job=t}getUserInfo(){return{name:this._name.textContent,about:this._job.textContent}}setUserInfo(e){this._name.textContent=e.name,this._job.textContent=e.about}}(i,o),g=new h(".popup_type_edit-profile",(()=>{L.setUserInfo(g.getInputsValues()),g.close()}));g.setEventListeners(),document.querySelector(".profile__edit-button").addEventListener("click",(()=>{g.open();const e=L.getUserInfo(i,o);a.value=e.name,d.value=e.about,v.resetValidation()}));const k=new h(".popup_type_add-card",(()=>{const e=k.getInputsValues();p.createCard(e).then((e=>{new t({item:e,renderer:y},r).addItem(y(e)),k.close()}))}));k.setEventListeners(),document.querySelector(".profile__add-button").addEventListener("click",(()=>{k.open(),b.resetValidation()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q3RDb0YsRUFBaUIvRixXQUVuQitGLEVBQWlCNUYsb0JBSU1yRSxTQUFTQyxjQUFjLHlCQUMvQmlDLGlCQUFpQixTQUFTLEtBQ3ZDK0gsRUFBaUIzRixPQUNqQixNQUFNNkYsRUFBV3ZDLEVBQVNuQixZQUFZcEQsRUFBYUMsR0FDbkRDLEVBQVUwQixNQUFRa0YsRUFBU25GLEtBQzNCeEIsRUFBaUJ5QixNQUFRa0YsRUFBU3JDLE1BQ2xDTixFQUFrQm5GLHFCQUlwQixNQUFNK0gsRUFBbUIsSUFBSUYsRUx6RVEsd0JLeUU2QixLQUNoRSxNQUFNdEgsRUFBT3dILEVBQWlCdkYsa0JBRTlCc0IsRUFBSU8sV0FBVzlELEdBQ1o0QyxNQUFLNkUsSUFDVSxJQUFJM0MsRUFBUSxDQUFFMkMsS0FBQUEsRUFBTTlILFNBQVVvRixHQUFjeEUsR0FDcERMLFFBQVE2RSxFQUFXMEMsSUFDekJELEVBQWlCbEcsY0FJdkJrRyxFQUFpQi9GLG9CQUVPckUsU0FBU0MsY0FBYyx3QkFDL0JpQyxpQkFBaUIsU0FBUyxLQUN4Q2tJLEVBQWlCOUYsT0FDakJtRCxFQUFxQnBGLHFCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC1tYWluLy4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80LW1haW4vLi9zcmMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQtbWFpbi8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC1tYWluLy4vc3JjL2NvbXBvbmVudHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80LW1haW4vLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80LW1haW4vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQtbWFpbi8uL3NyYy9jb21wb25lbnRzL0FwaS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80LW1haW4vLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC1tYWluLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC1tYWluLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoU3VibWl0LmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQtbWFpbi8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFNwcmludCA3IC0gcHJvamVjdCBMaXZlIENvZGluZywgTGl6YSAtIHRpbWUgb24gdmlkZW86IDA6MDAgLSA0MDowMCBtaW5zLlxuXG5jbGFzcyBGb3JtVmFsaWRhdG9yIHtcbiAgY29uc3RydWN0b3Ioc2V0dGluZ3MsIGZvcm1FbGVtZW50KSB7XG4gICAgdGhpcy5fc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCR7Zm9ybUVsZW1lbnR9YCk7XG4gIH1cblxuICBfc2hvd0Vycm9yTWVzc2FnZShpbnB1dCwgZXJyb3JNZXNzYWdlKSB7XG4gICAgY29uc3QgeyBpbnB1dEVycm9yQ2xhc3MsIGVycm9yQ2xhc3MgfSA9IHRoaXMuX3NldHRpbmdzO1xuICAgIHRoaXMuX2Vycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0LmlkfS1lcnJvcmApO1xuICAgIHRoaXMuX2Vycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcbiAgICB0aGlzLl9lcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZChpbnB1dEVycm9yQ2xhc3MpO1xuICAgIGlucHV0LmNsYXNzTGlzdC5hZGQoZXJyb3JDbGFzcyk7XG4gIH1cblxuICBfaGlkZUVycm9yTWVzc2FnZShpbnB1dCkge1xuICAgIGNvbnN0IHsgaW5wdXRFcnJvckNsYXNzLCBlcnJvckNsYXNzIH0gPSB0aGlzLl9zZXR0aW5ncztcbiAgICB0aGlzLl9lcnJvckVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dC5pZH0tZXJyb3JgKTtcbiAgICB0aGlzLl9lcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xuICAgIHRoaXMuX2Vycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGlucHV0RXJyb3JDbGFzcyk7XG4gICAgaW5wdXQuY2xhc3NMaXN0LnJlbW92ZShlcnJvckNsYXNzKTtcbiAgfVxuXG4gIF9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXQpIHtcbiAgICBpZiAoIWlucHV0LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBpbnB1dC52YWxpZGF0aW9uTWVzc2FnZTtcbiAgICAgIHRoaXMuX3Nob3dFcnJvck1lc3NhZ2UoaW5wdXQsIGVycm9yTWVzc2FnZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2hpZGVFcnJvck1lc3NhZ2UoaW5wdXQpO1xuICAgIH1cbiAgfVxuXG4gIF9pbnB1dHNMaXN0KCkge1xuICAgIGNvbnN0IHsgaW5wdXRTZWxlY3RvciB9ID0gdGhpcy5fc2V0dGluZ3M7XG4gICAgY29uc3QgaW5wdXRzTGlzdCA9IEFycmF5LmZyb20oXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKGlucHV0U2VsZWN0b3IpXG4gICAgKTtcbiAgICByZXR1cm4gaW5wdXRzTGlzdDtcbiAgfVxuXG4gIF9zZWxlY3RCdXR0b24oKSB7XG4gICAgY29uc3QgeyBzdWJtaXRCdXR0b25TZWxlY3RvciB9ID0gdGhpcy5fc2V0dGluZ3M7XG4gICAgY29uc3QgYnV0dG9uID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihzdWJtaXRCdXR0b25TZWxlY3Rvcik7XG4gICAgcmV0dXJuIGJ1dHRvbjtcbiAgfVxuXG4gIF90b2dnbGVCdXR0b25TdGF0ZSgpIHtcbiAgICBjb25zdCB7IGluYWN0aXZlQnV0dG9uQ2xhc3MgfSA9IHRoaXMuX3NldHRpbmdzO1xuICAgIGNvbnN0IGJ1dHRvbiA9IHRoaXMuX3NlbGVjdEJ1dHRvbigpO1xuICAgIGNvbnN0IGlucHV0TGlzdCA9IHRoaXMuX2lucHV0c0xpc3QoKTtcbiAgICBjb25zdCBpc0Zvcm1JbnZhbGlkID0gaW5wdXRMaXN0LnNvbWUoXG4gICAgICAoaW5wdXRFbGVtZW50KSA9PiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkXG4gICAgKTtcbiAgICBpZiAoIWlzRm9ybUludmFsaWQpIHtcbiAgICAgIGJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKGluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgICAgYnV0dG9uLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBidXR0b24uY2xhc3NMaXN0LmFkZChpbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICB9XG4gIH1cblxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgY29uc3QgaW5wdXRzTGlzdCA9IHRoaXMuX2lucHV0c0xpc3QoKTtcbiAgICBpbnB1dHNMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQpO1xuICAgICAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBlbmFibGVWYWxpZGF0aW9uKCkge1xuICAgIHRoaXMuX2Zvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge30pO1xuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cblxuICByZXNldFZhbGlkYXRpb24oKSB7XG4gICAgY29uc3QgeyBpbmFjdGl2ZUJ1dHRvbkNsYXNzIH0gPSB0aGlzLl9zZXR0aW5ncztcbiAgICBjb25zdCBidXR0b24gPSB0aGlzLl9zZWxlY3RCdXR0b24oKTtcbiAgICBidXR0b24uY2xhc3NMaXN0LmFkZChpbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICBidXR0b24uc2V0QXR0cmlidXRlKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpO1xuICAgIGNvbnN0IGlucHV0c0xpc3QgPSB0aGlzLl9pbnB1dHNMaXN0KCk7XG4gICAgaW5wdXRzTGlzdC5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgIHRoaXMuX2hpZGVFcnJvck1lc3NhZ2UoaW5wdXRFbGVtZW50KTtcbiAgICB9KTtcbiAgfVxufVxuXG5leHBvcnQgeyBGb3JtVmFsaWRhdG9yIH07XG4iLCJjbGFzcyBTZWN0aW9uIHtcbiAgY29uc3RydWN0b3IoeyBpdGVtcywgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IpIHtcbiAgICB0aGlzLl9pdGVtcyA9IGl0ZW1zO1xuICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgdGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJTZWxlY3Rvcik7XG4gIH1cblxuICAvLyBQdWJsaWMgbWV0aG9kIHRoYXQgcmVuZGVycyBhbGwgZWxlbWVudHMgb24gdGhlIHBhZ2UuXG4gIHJlbmRlcmVyKCkge1xuICAgIHRoaXMuX2l0ZW1zLmZvckVhY2goKGRhdGEpID0+IHtcbiAgICAgIGNvbnN0IGNhcmQgPSB0aGlzLl9yZW5kZXJlcihkYXRhKTtcbiAgICAgIHRoaXMuYWRkSXRlbShjYXJkKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFB1YmxpYyBtZXRob2QgdGhhdCB0YWtlcyBhIERPTSBlbGVtZW50IGFuZCBhZGRzIGl0IHRvIHRoZSBjb250YWluZXIuXG4gIGFkZEl0ZW0oY2FyZEVsZW1lbnQpIHtcbiAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChjYXJkRWxlbWVudCk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgU2VjdGlvbjtcbiIsIi8vIGltcG9ydCBoYXZhbmEgZnJvbSAnLi4vaW1hZ2VzL2hhdmFuYS5qcGcnO1xuLy8gaW1wb3J0IHZpbmFsZXMgZnJvbSAnLi4vaW1hZ2VzL3ZpbmFsZXMuanBnJztcbi8vIGltcG9ydCBwZWxpY2FuIGZyb20gJy4uL2ltYWdlcy9wZWxpY2FuLmpwZydcbi8vIGltcG9ydCBhcmRlYUhlcm9kaWFzIGZyb20gJy4uL2ltYWdlcy9hcmRlYS1oZXJvZGlhcy5qcGcnO1xuLy8gaW1wb3J0IHZpZXdGcm9tTWFuYXJhIGZyb20gJy4uL2ltYWdlcy92aWV3LWZyb20tbWFuYXJhLmpwZyc7XG4vLyBpbXBvcnQgYmlyaXlhRm9yZXN0IGZyb20gJy4uL2ltYWdlcy9iaXJpeWEtZm9yZXN0LmpwZyc7XG5cbi8vIEluaXRpYWxpemF0aW9uIGNhcmRzIG9uIGxvYWRpbmcgcGFnZS5cbi8vIGV4cG9ydCBjb25zdCBpbml0aWFsQ2FyZHMgPSBbXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIk9sZGllcyBjYXJzIGluIEhhdmFuYSwgQ3ViYS5cIixcbi8vICAgICBsaW5rOiBoYXZhbmFcbi8vICAgfSxcbi8vICAge1xuLy8gICAgIG5hbWU6IFwiVG9iYWNjbyBmaWVsZCBpbiBWacOxYWxlcyB2YWxsZXksIEN1YmEuXCIsXG4vLyAgICAgbGluazogdmluYWxlc1xuLy8gICB9LFxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJQZWxpY2FuIGluIGEgbGFrZSwgU2FyYXNvdGEgRkwsIFVTQS5cIixcbi8vICAgICBsaW5rOiBwZWxpY2FuXG4vLyAgIH0sXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIkdyZWF0IGJsdWUgaGVyb24sIFNhcmFzb3RhIEZMLCBVU0EuXCIsXG4vLyAgICAgbGluazogYXJkZWFIZXJvZGlhc1xuLy8gICB9LFxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJTaWdodCBmcm9tIE1hbmFyYSB0byBzb3V0aGVybiBMZWJhbm9uIGluIHdpbnRlciAsIElzcmFlbC5cIixcbi8vICAgICBsaW5rOiB2aWV3RnJvbU1hbmFyYVxuLy8gICB9LFxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJCaXJpeWEgZm9yZXN0LCBaZWZhdCwgSXNyYWVsXCIsXG4vLyAgICAgbGluazogYmlyaXlhRm9yZXN0XG4vLyAgIH1cbi8vIF07XG5cbmV4cG9ydCBjb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGVtcGxhdGVcIikuY29udGVudDtcbmV4cG9ydCBjb25zdCBjYXJkc0NvbnRhaW5lciA9IFwiLmNhcmRzX19jb250YWluZXJcIjtcblxuLy8gRm9ybSBWYWxpZGF0aW9uIGNsYXNzZXMuXG5leHBvcnQgY29uc3QgY29uZmlnID0ge1xuICBpbnB1dFNlbGVjdG9yOiBcIi5wb3B1cF9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLnBvcHVwX19zdWJtaXQtYnV0dG9uXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwicG9wdXBfX3N1Ym1pdC1idXR0b25fZGlzYWJsZVwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwicG9wdXBfX2lucHV0X3R5cGVfZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJwb3B1cF9faW5wdXRfZXJyb3ItdmlzaWJsZVwiLFxufTtcblxuZXhwb3J0IGNvbnN0IHByb2ZpbGVGb3JtUG9wdXAgPSBcIi5wb3B1cF9fZm9ybV9wcm9maWxlXCI7XG5leHBvcnQgY29uc3QgcHJvZmlsZUZvcm1Qb3B1cFNlbGVjdG9yID0gXCIucG9wdXBfdHlwZV9lZGl0LXByb2ZpbGVcIjtcbmV4cG9ydCBjb25zdCBjYXJkRm9ybVBvcHVwID0gXCIucG9wdXBfX2Zvcm1fYWRkLWNhcmRcIjtcbmV4cG9ydCBjb25zdCBjYXJkRm9ybVBvcHVwU2VsZWN0b3IgPSBcIi5wb3B1cF90eXBlX2FkZC1jYXJkXCI7XG5leHBvcnQgY29uc3QgcG9wdXBGb3JEZWxldGVDYXJkID0gXCIucG9wdXBfdHlwZV9kZWxldGUtY2FyZFwiO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVEZXNjcmlwdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCJcbik7XG5leHBvcnQgY29uc3QgcG9wdXBOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9faW5wdXRfY29udGVudF9uYW1lXCIpO1xuZXhwb3J0IGNvbnN0IHBvcHVwRGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIi5wb3B1cF9faW5wdXRfY29udGVudF9kZXNjcmlwdGlvblwiXG4pO1xuXG4vLyBJbWFnZSBwb3B1cC5cbmV4cG9ydCBjb25zdCBwb3B1cFR5cGVJbWFnZVNlbGVjdG9yID0gXCIucG9wdXBfdHlwZV9pbWFnZVwiO1xuLy8gZXhwb3J0IGNvbnN0IHBvcHVwVHlwZUltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF90eXBlX2ltYWdlXCIpO1xuZXhwb3J0IGNvbnN0IHBvcHVwSW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbWFnZVwiKTtcbmV4cG9ydCBjb25zdCBwb3B1cEltYWdlRGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIi5wb3B1cF9faW1hZ2UtZGVzY3JpcHRpb25cIlxuKTtcbiIsImNsYXNzIENhcmQge1xuICBjb25zdHJ1Y3Rvcih7ZGF0YSwgaGFuZGxlQ2FyZENsaWNrLCBoYW5kbGVEZWxldGVDYXJkLCBoYW5kbGVMaWtlSWNvbn0sIGNhcmRUZW1wbGF0ZSwgdXNlcklkKSB7XG4gICAgdGhpcy5fdGVtcGxhdGUgPSBjYXJkVGVtcGxhdGU7XG4gICAgdGhpcy5fbmFtZSA9IGRhdGEubmFtZTtcbiAgICB0aGlzLl9saW5rID0gZGF0YS5saW5rO1xuICAgIHRoaXMuX293bmVySWQgPSBkYXRhLm93bmVyLl9pZDtcbiAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2sgPSBoYW5kbGVDYXJkQ2xpY2s7XG4gICAgdGhpcy5faGFuZGxlTGlrZUljb24gPSBoYW5kbGVMaWtlSWNvbjtcbiAgICB0aGlzLl9oYW5kbGVEZWxldGVDYXJkID0gaGFuZGxlRGVsZXRlQ2FyZDtcbiAgICB0aGlzLl91c2VySWQgPSB1c2VySWQ7XG4gICAgdGhpcy5fbGlrZXMgPSBkYXRhLmxpa2VzO1xuICAgIHRoaXMuX2NhcmRJZCA9IGRhdGEuX2lkO1xuICB9XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIC8vIExpa2UgYnV0dG9ucy5cbiAgICBjb25zdCBsaWtlQnV0dG9uID0gdGhpcy5fY2FyZC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19saWtlLWJ1dHRvblwiKTtcbiAgICAgIGxpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuX2hhbmRsZUxpa2VJY29uKHRoaXMuX2NhcmRJZCwgdGhpcy5fdXNlcklkLCB0aGlzLl9saWtlcywgbGlrZUJ1dHRvbikpO1xuICAgICAgLy8gYnV0dG9uTGlrZS5jbGFzc0xpc3QuYWRkKFwiY2FyZHNfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcblxuICAgIC8vIERlbGV0ZSBidXR0b25zLlxuICAgIHRoaXMuX2NhcmQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fZGVsZXRlLWJ1dHRvblwiKVxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiAgdGhpcy5faGFuZGxlRGVsZXRlQ2FyZCh0aGlzLl91c2VySWQpKTtcbiAgICBpZih0aGlzLl9vd25lcklkICE9PSB0aGlzLl91c2VySWQpIHtcbiAgICAgIHRoaXMuX2NhcmQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fZGVsZXRlLWJ1dHRvblwiKS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgfVxuXG4gICAgLy8gU2hvdyBpbWFnZSBhcyBwb3B1cC5cbiAgICBjb25zdCBjYXJkRGF0YSA9IHsgbmFtZTogdGhpcy5fbmFtZSwgbGluazogdGhpcy5fbGluayB9O1xuICAgIHRoaXMuX2NhcmQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19faW1hZ2VcIilcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICB0aGlzLl9oYW5kbGVDYXJkQ2xpY2soY2FyZERhdGEpO1xuICAgICAgfSk7XG4gIH1cbiAgICBcbiAgcmVtb3ZlQ2FyZCgpIHtcbiAgICB0aGlzLl9jYXJkLnJlbW92ZSgpO1xuICAgIHRoaXMuX2NhcmQgPSBudWxsO1xuICB9XG5cbiAgY3JlYXRlQ2FyZCgpIHtcbiAgICBjb25zdCBjYXJkID0gdGhpcy5fdGVtcGxhdGVcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19jYXJkXCIpXG4gICAgICAuY2xvbmVOb2RlKHRydWUpO1xuICAgIGNvbnN0IGltZyA9IGNhcmQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19faW1hZ2VcIik7XG4gICAgaW1nLnNldEF0dHJpYnV0ZShcInNyY1wiLCB0aGlzLl9saW5rKTtcbiAgICBpbWcuc2V0QXR0cmlidXRlKFwiYWx0XCIsIHRoaXMuX25hbWUpO1xuXG4gICAgY29uc3QgY2FyZFRpdGxlID0gY2FyZC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19oZWFkZXJcIik7XG4gICAgY2FyZFRpdGxlLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcblxuICAgIHRoaXMuX2NhcmQgPSBjYXJkO1xuICAgIHRoaXMuX2NhcmQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlrZXMtY291bnRlclwiKS50ZXh0Q29udGVudCA9IHRoaXMuX2xpa2VzLmxlbmd0aCBcblxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgcmV0dXJuIHRoaXMuX2NhcmQ7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQ2FyZDtcbiIsImNsYXNzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgIHRoaXMuX3BvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihwb3B1cFNlbGVjdG9yKTtcbiAgICB0aGlzLl9oYW5kbGVFc2NDbG9zZSA9IHRoaXMuX2hhbmRsZUVzY0Nsb3NlLmJpbmQodGhpcyk7XG4gICAgdGhpcy5faGFuZGxlQ2xvc2VQb3B1cHdXaXRoT3ZlcmxheSA9XG4gICAgICB0aGlzLl9oYW5kbGVDbG9zZVBvcHVwd1dpdGhPdmVybGF5LmJpbmQodGhpcyk7XG4gIH1cblxuICAvLyBQcml2YXRlIG1ldGhvZCB0aGF0IGNsb3NlIHBvcHVwIHdpbmRvdyBieSBFc2NhcGUga2V5LlxuICBfaGFuZGxlRXNjQ2xvc2UoZXZlbnQpIHtcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICB9XG5cbiAgLy8gUHJpdmF0ZSBtZXRob2QgdGhhdCBjbG9zZSBwb3B1cCB3aW5kb3cgYnkgY2xpY2tpbmcgb24gdGhlIG92ZXJsYXkuXG4gIF9oYW5kbGVDbG9zZVBvcHVwd1dpdGhPdmVybGF5KGV2ZW50KSB7XG4gICAgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwb3B1cF9vcGVuXCIpKSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICB9XG5cbiAgLy8gUHVibGljIG1ldGhvZCB0aGF0IGFkZHMgYW4gZXZlbnQgbGlzdGVuZXIgdG8gdGhlIGNsb3NlIGljb24gb2YgdGhlIHBvcHVwLlxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICBjb25zdCBjbG9zZUJ1dHRvbiA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Nsb3NlLWJ1dHRvblwiKTtcblxuICAgIGNsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBQdWJsaWMgbWV0aG9kIHRoYXQgb3BlbiB0aGUgcG9wdXAgd2luZG93LlxuICBvcGVuKCkge1xuICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5hZGQoXCJwb3B1cF9vcGVuXCIpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIHRoaXMuX2hhbmRsZUNsb3NlUG9wdXB3V2l0aE92ZXJsYXkpO1xuICB9XG5cbiAgLy8gUHVibGljIG1ldGhvZCB0aGF0IGNsb3NlIHRoZSBwb3B1cCB3aW5kb3cuXG4gIGNsb3NlKCkge1xuICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5yZW1vdmUoXCJwb3B1cF9vcGVuXCIpO1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIHRoaXMuX2hhbmRsZUNsb3NlUG9wdXB3V2l0aE92ZXJsYXkpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFBvcHVwO1xuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwLmpzXCI7XG5cbmNsYXNzIFBvcHVwV2l0aEZvcm0gZXh0ZW5kcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IsIHN1Ym1pdEhhbmRsZXIpIHtcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTsgLy8gdGhpcy5fcG9wdXBcbiAgICB0aGlzLl9zdWJtaXRIYW5kbGVyID0gc3VibWl0SGFuZGxlcjtcbiAgICB0aGlzLl9mb3JtID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybVwiKTtcbiAgfVxuXG4gIC8vIFByaXZhdGUgbWV0aG9kIHdoaWNoIGNvbGxlY3QgZGF0YSBmcm9tIGFsbCB0aGUgaW5wdXQgZmllbGRzLlxuICBnZXRJbnB1dHNWYWx1ZXMoKSB7XG4gICAgY29uc3QgaW5wdXRzID0gQXJyYXkuZnJvbSh0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoXCIucG9wdXBfX2lucHV0XCIpKTtcbiAgICBjb25zdCBpbnB1dHNWYWx1ZXMgPSB7fTtcbiAgICBpbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgIGlucHV0c1ZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO1xuICAgIH0pO1xuICAgIHJldHVybiBpbnB1dHNWYWx1ZXM7XG4gIH1cblxuICAvLyBNb2RpZmllcyB0aGUgcGFyZW50IG1ldGhvZCBhbmQgYWRkIGV2ZW50IGxpc3RlbmVyIHRvIGNsb3NlIGljb24gYW5kIHN1Ym1pdCBidXR0b24uXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5fc3VibWl0SGFuZGxlcigpO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gTW9kaWZpZXMgdGhlIHBhcmVudCBtZXRob2QgaW4gb3JkZXIgdG8gcmVzZXQgdGhlIGZvcm0gb25jZSB0aGUgcG9wdXAgaXMgY2xvc2VkLlxuICBjbG9zZSgpIHtcbiAgICBzdXBlci5jbG9zZSgpO1xuICAgIHRoaXMuX2Zvcm0ucmVzZXQoKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBQb3B1cFdpdGhGb3JtO1xuIiwiY29uc3QgY3VzdG9tRmV0Y2ggPSAodXJsLCBoZWFkZXJzKSA9PlxyXG4gIGZldGNoKHVybCwgaGVhZGVycylcclxuICAgIC50aGVuKHJlcyA9PiByZXMub2sgPyByZXMuanNvbigpIDogUHJvbWlzZS5yZWplY3QocmVzLnN0YXR1c1RleHQpKVxyXG4gICAgLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZyhlcnIpKVxyXG5cclxuY2xhc3MgQXBpIHtcclxuICAgIGNvbnN0cnVjdG9yKHtiYXNlVXJsLCBoZWFkZXJzfSkge1xyXG4gICAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcclxuICAgICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XHJcbiAgICB9XHJcblxyXG4gIC8vIG90aGVyIG1ldGhvZHMgZm9yIHdvcmtpbmcgd2l0aCB0aGUgQVBJXHJcblxyXG4gIGdldEluaXRpYWxDYXJkcygpIHtcclxuICAgIHJldHVybiBjdXN0b21GZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICAgIG1ldGhvZDogJ0dFVCcgLy8gZGVmYXVsdCBvcHRpb25cclxuICAgIH0pXHJcbiAgfVxyXG4gIFxyXG4gIGdldFVzZXJJbmZvKCkge1xyXG4gICAgcmV0dXJuIGN1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnNcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICBjcmVhdGVDYXJkKGRhdGEpIHtcclxuICAgIHJldHVybiBjdXN0b21GZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLCBcclxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShkYXRhKVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIGRlbGV0ZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gY3VzdG9tRmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xyXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsIFxyXG4gICAgICAgIG1ldGhvZDogJ0RFTEVURScsXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgbGlrZUNhcmQoY2FyZElkKSB7XHJcbiAgICBjb25zb2xlLmxvZyhcImNhcmRJZFwiLCBjYXJkSWQpO1xyXG4gICAgcmV0dXJuIGN1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcclxuICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLCBcclxuICAgICAgICBtZXRob2Q6ICdQVVQnLFxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIGRpc2xpa2VDYXJkKGNhcmRJZCkge1xyXG4gICAgcmV0dXJuIGN1c3RvbUZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcclxuICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLCBcclxuICAgICAgICBtZXRob2Q6ICdERUxFVEUnLFxyXG4gICAgfSlcclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBBcGk7IiwiaW1wb3J0ICcuL2luZGV4LmNzcyc7XG5pbXBvcnQgeyBGb3JtVmFsaWRhdG9yIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qc1wiO1xuaW1wb3J0IFNlY3Rpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvU2VjdGlvbi5qc1wiO1xuaW1wb3J0IHtcbiAgY2FyZFRlbXBsYXRlLFxuICBwcm9maWxlRm9ybVBvcHVwLFxuICBjb25maWcsXG4gIGNhcmRGb3JtUG9wdXAsXG4gIGNhcmRzQ29udGFpbmVyLFxuICBpbml0aWFsQ2FyZHMsXG4gIHByb2ZpbGVGb3JtUG9wdXBTZWxlY3RvcixcbiAgY2FyZEZvcm1Qb3B1cFNlbGVjdG9yLFxuICBwcm9maWxlTmFtZSxcbiAgcHJvZmlsZURlc2NyaXB0aW9uLFxuICBwb3B1cFR5cGVJbWFnZVNlbGVjdG9yLFxuICBwb3B1cE5hbWUsXG4gIHBvcHVwRGVzY3JpcHRpb24sXG4gIHBvcHVwRm9yRGVsZXRlQ2FyZFxufSBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkLmpzXCI7XG5pbXBvcnQgUG9wdXAgZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXAuanNcIjtcbmltcG9ydCBQb3B1cFdpdGhTdWJtaXQgZnJvbSAnLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhTdWJtaXQnO1xuaW1wb3J0IFBvcHVwV2l0aEZvcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qc1wiO1xuaW1wb3J0IFBvcHVwV2l0aEltYWdlIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzXCI7XG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL2NvbXBvbmVudHMvVXNlckluZm8uanNcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL2NvbXBvbmVudHMvQXBpLmpzXCI7XG5cbi8vIFRva2VuOiAzOGEyMzg3OC02NGNlLTRhYmItYWUwZC1kMzBkMTFjYzlhMzggR3JvdXAgSUQ6IGdyb3VwLTEyXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2dyb3VwLTEyXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcIjM4YTIzODc4LTY0Y2UtNGFiYi1hZTBkLWQzMGQxMWNjOWEzOFwiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gIH1cbn0pO1xuXG5sZXQgdXNlcklkO1xuXG5jb25zdCBpbWFnZVBvcHVwID0gbmV3IFBvcHVwV2l0aEltYWdlKHBvcHVwVHlwZUltYWdlU2VsZWN0b3IpO1xuaW1hZ2VQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuXG5jb25zdCBlZGl0Rm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGNvbmZpZywgcHJvZmlsZUZvcm1Qb3B1cCk7XG5jb25zdCBhZGRDYXJkRm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGNvbmZpZywgY2FyZEZvcm1Qb3B1cCk7XG5cbmVkaXRGb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcbmFkZENhcmRGb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcblxuYXBpLmdldEluaXRpYWxDYXJkcygpXG4udGhlbihpdGVtcyA9PiB7XG4gIGNvbnN0IGNhcmRzID0gbmV3IFNlY3Rpb24oeyBpdGVtcywgcmVuZGVyZXI6IGFkZE5ld0NhcmQgfSwgY2FyZHNDb250YWluZXIpO1xuICBjYXJkcy5yZW5kZXJlcigpO1xufSlcblxuYXBpLmdldFVzZXJJbmZvKClcbiAgLnRoZW4ocmVzID0+IHtcbiAgICB1c2VySW5mby5zZXRVc2VySW5mbyh7bmFtZTogcmVzLm5hbWUsIGFib3V0OiByZXMuYWJvdXR9KVxuICAgIHVzZXJJZCA9IHJlcy5faWRcbiAgfSlcblxuXG4gIGNvbnN0IHBvcHVwQXNrRm9yRGVsZXRlID0gbmV3IFBvcHVwV2l0aFN1Ym1pdChwb3B1cEZvckRlbGV0ZUNhcmQpO1xuICBwb3B1cEFza0ZvckRlbGV0ZS5zZXRFdmVudExpc3RlbmVycygpXG5cbmNvbnN0IGFkZE5ld0NhcmQgPSAoZGF0YSkgPT4ge1xuICBjb25zdCBjYXJkID0gbmV3IENhcmQoe1xuICAgIGRhdGEsXG4gICAgaGFuZGxlQ2FyZENsaWNrOiAoKSA9PiB7XG4gICAgICBpbWFnZVBvcHVwLm9wZW4oZGF0YSk7XG4gICAgfSxcbiAgICBoYW5kbGVMaWtlSWNvbjogKGNhcmRJZCwgdXNlcklkLCBsaWtlc0FycmF5LCBsaWtlQnV0dG9uKSA9PiB7XG4gICAgICBpZiAoIWxpa2VzQXJyYXkuZmluZCh1c2VyID0+IHVzZXIuX2lkID09PSB1c2VySWQgKSkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIkxJS0VcIik7XG4gICAgICAgIGNvbnNvbGUubG9nKGxpa2VCdXR0b24pO1xuICAgICAgICBsaWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjYXJkc19fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICAgICAgICBhcGkubGlrZUNhcmQoY2FyZElkKVxuICAgICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJBZGRlZCBsaWtlIHRvIGNhcmQ6IFwiLCByZXMpO1xuICAgICAgICB9KVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJESVNMSUtFXCIpO1xuICAgICAgICBjb25zb2xlLmxvZyhsaWtlQnV0dG9uKTtcbiAgICAgICAgbGlrZUJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwiY2FyZHNfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcbiAgICAgICAgYXBpLmRpc2xpa2VDYXJkKGNhcmRJZClcbiAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiUmVtb3ZlZCBsaWtlIGZyb20gY2FyZDogXCIsIHJlcyk7XG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSxcbiAgICBoYW5kbGVEZWxldGVDYXJkOiAoKSA9PiB7XG4gICAgICBwb3B1cEFza0ZvckRlbGV0ZS5vcGVuKCk7XG4gICAgICBwb3B1cEFza0ZvckRlbGV0ZS5zZXRFdmVudExpc3RlbmVycygpO1xuICAgICAgcG9wdXBBc2tGb3JEZWxldGUuc2V0QWN0aW9uKCgpID0+IHtcbiAgICAgICAgYXBpLmRlbGV0ZUNhcmQoZGF0YS5faWQpXG4gICAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJjYXJkIGlzIGRlbGV0ZWRcIiwgcmVzKTtcbiAgICAgICAgICAgIGNhcmQucmVtb3ZlQ2FyZCgpO1xuICAgICAgICAgIH0pXG4gICAgICB9KVxuICAgIH1cbiAgfSwgY2FyZFRlbXBsYXRlLCB1c2VySWQpO1xuICByZXR1cm4gY2FyZC5jcmVhdGVDYXJkKCk7XG59O1xuXG4vLyBQb3B1cCBmb3IgcHJvZmlsZSBkZXRhaWxzIGZvcm0uXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyhwcm9maWxlTmFtZSwgcHJvZmlsZURlc2NyaXB0aW9uKTtcbmNvbnN0IHBvcHVwV2l0aFByb2ZpbGUgPSBuZXcgUG9wdXBXaXRoRm9ybShwcm9maWxlRm9ybVBvcHVwU2VsZWN0b3IsICgpID0+IHtcbiAgdXNlckluZm8uc2V0VXNlckluZm8ocG9wdXBXaXRoUHJvZmlsZS5nZXRJbnB1dHNWYWx1ZXMoKSk7XG4gIHBvcHVwV2l0aFByb2ZpbGUuY2xvc2UoKTtcbn0pO1xucG9wdXBXaXRoUHJvZmlsZS5zZXRFdmVudExpc3RlbmVycygpO1xuXG5cblxuY29uc3Qgb3BlbkVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnV0dG9uXCIpO1xub3BlbkVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgcG9wdXBXaXRoUHJvZmlsZS5vcGVuKCk7XG4gIGNvbnN0IHVzZXJEYXRhID0gdXNlckluZm8uZ2V0VXNlckluZm8ocHJvZmlsZU5hbWUsIHByb2ZpbGVEZXNjcmlwdGlvbik7XG4gIHBvcHVwTmFtZS52YWx1ZSA9IHVzZXJEYXRhLm5hbWU7XG4gIHBvcHVwRGVzY3JpcHRpb24udmFsdWUgPSB1c2VyRGF0YS5hYm91dDtcbiAgZWRpdEZvcm1WYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKCk7XG59KTtcblxuLy8gUG9wdXAgZm9yIGFkZCBjYXJkIGZvcm0uXG5jb25zdCBwb3B1cFdpdGhBZGRDYXJkID0gbmV3IFBvcHVwV2l0aEZvcm0oY2FyZEZvcm1Qb3B1cFNlbGVjdG9yLCAoKSA9PiB7XG4gIGNvbnN0IGRhdGEgPSBwb3B1cFdpdGhBZGRDYXJkLmdldElucHV0c1ZhbHVlcygpXG4gIFxuICBhcGkuY3JlYXRlQ2FyZChkYXRhKVxuICAgIC50aGVuKGl0ZW0gPT4ge1xuICAgICAgY29uc3QgY2FyZHMgPSBuZXcgU2VjdGlvbih7IGl0ZW0sIHJlbmRlcmVyOiBhZGROZXdDYXJkIH0sIGNhcmRzQ29udGFpbmVyKTtcbiAgICAgIGNhcmRzLmFkZEl0ZW0oYWRkTmV3Q2FyZChpdGVtKSk7XG4gICAgICBwb3B1cFdpdGhBZGRDYXJkLmNsb3NlKCk7XG4gICAgfSk7XG59KVxuICBcbnBvcHVwV2l0aEFkZENhcmQuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuY29uc3Qgb3BlbkFkZENhcmRGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnV0dG9uXCIpO1xub3BlbkFkZENhcmRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIHBvcHVwV2l0aEFkZENhcmQub3BlbigpO1xuICBhZGRDYXJkRm9ybVZhbGlkYXRvci5yZXNldFZhbGlkYXRpb24oKTtcbn0pO1xuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwLmpzXCI7XG5pbXBvcnQgKiBhcyBjb25zdGFudHMgZnJvbSBcIi4uLy4uL3NyYy91dGlscy9jb25zdGFudHMuanNcIjtcblxuY2xhc3MgUG9wdXBXaXRoSW1hZ2UgZXh0ZW5kcyBQb3B1cCB7XG4gIG9wZW4oY2FyZERhdGEpIHtcbiAgICBzdXBlci5vcGVuKCk7XG4gICAgY29uc3RhbnRzLnBvcHVwSW1hZ2Uuc3JjID0gY2FyZERhdGEubGluaztcbiAgICBjb25zdGFudHMucG9wdXBJbWFnZS5hbHQgPSBjYXJkRGF0YS5uYW1lO1xuICAgIGNvbnN0YW50cy5wb3B1cEltYWdlRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSBjYXJkRGF0YS5uYW1lO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFBvcHVwV2l0aEltYWdlO1xuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwLmpzXCI7XHJcblxyXG5jbGFzcyBQb3B1cFdpdGhTdWJtaXQgZXh0ZW5kcyBQb3B1cCB7XHJcbiAgc2V0QWN0aW9uKGFjdGlvbikge1xyXG4gICAgICB0aGlzLl9zdWJtaXRIYW5kbGVyID0gYWN0aW9uO1xyXG4gIH1cclxuXHJcbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9wb3B1cC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcclxuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIHRoaXMuX3N1Ym1pdEhhbmRsZXIoKTtcclxuICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgUG9wdXBXaXRoU3VibWl0OyIsImltcG9ydCB7IHByb2ZpbGVOYW1lLCBwcm9maWxlRGVzY3JpcHRpb24gfSBmcm9tIFwiLi4vLi4vc3JjL3V0aWxzL2NvbnN0YW50cy5qc1wiO1xuXG5jbGFzcyBVc2VySW5mbyB7XG4gIGNvbnN0cnVjdG9yKG5hbWVTZWxlY3Rvciwgam9iU2VsZWN0b3IpIHtcbiAgICB0aGlzLl9uYW1lID0gbmFtZVNlbGVjdG9yO1xuICAgIHRoaXMuX2pvYiA9IGpvYlNlbGVjdG9yO1xuICB9XG5cbiAgLy8gUHVibGljIG1ldGhvZCB3aGljaCByZXR1cm5zIGFuIG9iamVjdCB3aXRoIGluZm9ybWF0aW9uIGFib3V0IHRoZSB1c2VyLlxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4geyBuYW1lOiB0aGlzLl9uYW1lLnRleHRDb250ZW50LCBhYm91dDogdGhpcy5fam9iLnRleHRDb250ZW50IH07XG4gIH1cblxuICAvLyBQdWJsaWMgbWV0aG9kIHdoaWNoIHRha2VzIG5ldyB1c2VyIGRhdGEgYW5kIGFkZHMgaXQgb24gdGhlIHBhZ2UuXG4gIHNldFVzZXJJbmZvKG5ld0NhcmREYXRhKSB7XG4gICAgdGhpcy5fbmFtZS50ZXh0Q29udGVudCA9IG5ld0NhcmREYXRhLm5hbWU7XG4gICAgdGhpcy5fam9iLnRleHRDb250ZW50ID0gbmV3Q2FyZERhdGEuYWJvdXQ7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgVXNlckluZm87XG4iXSwibmFtZXMiOlsiRm9ybVZhbGlkYXRvciIsImNvbnN0cnVjdG9yIiwic2V0dGluZ3MiLCJmb3JtRWxlbWVudCIsInRoaXMiLCJfc2V0dGluZ3MiLCJfZm9ybUVsZW1lbnQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJfc2hvd0Vycm9yTWVzc2FnZSIsImlucHV0IiwiZXJyb3JNZXNzYWdlIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsIl9lcnJvckVsZW1lbnQiLCJpZCIsInRleHRDb250ZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiX2hpZGVFcnJvck1lc3NhZ2UiLCJyZW1vdmUiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwidmFsaWRpdHkiLCJ2YWxpZCIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2lucHV0c0xpc3QiLCJpbnB1dFNlbGVjdG9yIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsIl9zZWxlY3RCdXR0b24iLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsIl90b2dnbGVCdXR0b25TdGF0ZSIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJidXR0b24iLCJzb21lIiwiaW5wdXRFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwicmVtb3ZlQXR0cmlidXRlIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiZm9yRWFjaCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlbmFibGVWYWxpZGF0aW9uIiwiZXZ0IiwicmVzZXRWYWxpZGF0aW9uIiwiaXRlbXMiLCJyZW5kZXJlciIsImNvbnRhaW5lclNlbGVjdG9yIiwiX2l0ZW1zIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsImRhdGEiLCJjYXJkIiwiYWRkSXRlbSIsImNhcmRFbGVtZW50IiwicHJlcGVuZCIsImNhcmRUZW1wbGF0ZSIsImNvbnRlbnQiLCJjYXJkc0NvbnRhaW5lciIsImNvbmZpZyIsInByb2ZpbGVOYW1lIiwicHJvZmlsZURlc2NyaXB0aW9uIiwicG9wdXBOYW1lIiwicG9wdXBEZXNjcmlwdGlvbiIsInBvcHVwSW1hZ2UiLCJwb3B1cEltYWdlRGVzY3JpcHRpb24iLCJwb3B1cFNlbGVjdG9yIiwiX3BvcHVwIiwiX2hhbmRsZUVzY0Nsb3NlIiwiYmluZCIsIl9oYW5kbGVDbG9zZVBvcHVwd1dpdGhPdmVybGF5IiwiZXZlbnQiLCJrZXkiLCJjbG9zZSIsInRhcmdldCIsImNvbnRhaW5zIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJvcGVuIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIlBvcHVwIiwic3VibWl0SGFuZGxlciIsInN1cGVyIiwiX3N1Ym1pdEhhbmRsZXIiLCJfZm9ybSIsImdldElucHV0c1ZhbHVlcyIsImlucHV0cyIsImlucHV0c1ZhbHVlcyIsIm5hbWUiLCJ2YWx1ZSIsInByZXZlbnREZWZhdWx0IiwicmVzZXQiLCJjdXN0b21GZXRjaCIsInVybCIsImhlYWRlcnMiLCJmZXRjaCIsInRoZW4iLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzVGV4dCIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImxvZyIsImFwaSIsImJhc2VVcmwiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0SW5pdGlhbENhcmRzIiwibWV0aG9kIiwiZ2V0VXNlckluZm8iLCJjcmVhdGVDYXJkIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJkZWxldGVDYXJkIiwiY2FyZElkIiwibGlrZUNhcmQiLCJkaXNsaWtlQ2FyZCIsImF1dGhvcml6YXRpb24iLCJ1c2VySWQiLCJpbWFnZVBvcHVwIiwiY2FyZERhdGEiLCJjb25zdGFudHMiLCJsaW5rIiwiZWRpdEZvcm1WYWxpZGF0b3IiLCJhZGRDYXJkRm9ybVZhbGlkYXRvciIsIlNlY3Rpb24iLCJhZGROZXdDYXJkIiwidXNlckluZm8iLCJzZXRVc2VySW5mbyIsImFib3V0IiwiX2lkIiwicG9wdXBBc2tGb3JEZWxldGUiLCJzZXRBY3Rpb24iLCJhY3Rpb24iLCJoYW5kbGVDYXJkQ2xpY2siLCJoYW5kbGVEZWxldGVDYXJkIiwiaGFuZGxlTGlrZUljb24iLCJfdGVtcGxhdGUiLCJfbmFtZSIsIl9saW5rIiwiX293bmVySWQiLCJvd25lciIsIl9oYW5kbGVDYXJkQ2xpY2siLCJfaGFuZGxlTGlrZUljb24iLCJfaGFuZGxlRGVsZXRlQ2FyZCIsIl91c2VySWQiLCJfbGlrZXMiLCJsaWtlcyIsIl9jYXJkSWQiLCJsaWtlQnV0dG9uIiwiX2NhcmQiLCJzdHlsZSIsImRpc3BsYXkiLCJyZW1vdmVDYXJkIiwiY2xvbmVOb2RlIiwiaW1nIiwibGVuZ3RoIiwibGlrZXNBcnJheSIsImZpbmQiLCJ1c2VyIiwibmFtZVNlbGVjdG9yIiwiam9iU2VsZWN0b3IiLCJfam9iIiwibmV3Q2FyZERhdGEiLCJwb3B1cFdpdGhQcm9maWxlIiwiUG9wdXBXaXRoRm9ybSIsInVzZXJEYXRhIiwicG9wdXBXaXRoQWRkQ2FyZCIsIml0ZW0iXSwic291cmNlUm9vdCI6IiJ9